<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Testar Login - Debug</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #000;
            padding: 20px;
            border: 2px solid #00ff00;
            border-radius: 8px;
        }
        h1 { color: #00ff00; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
        }
        button:hover { background: #00cc00; }
        .log {
            background: #222;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #00ff00;
            white-space: pre-wrap;
            font-size: 14px;
        }
        .error { border-left-color: #ff0000; color: #ff6666; }
        .success { border-left-color: #00ff00; color: #00ff00; }
        .warning { border-left-color: #ffaa00; color: #ffcc66; }
        input {
            background: #222;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 8px;
            margin: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê TESTE DE LOGIN - DEBUG MODE</h1>
        
        <div class="log success">
            <strong>PASSO 1: VERIFICAR FUNCION√ÅRIOS</strong>
        </div>
        <button onclick="verificarFuncionarios()">üìã Ver Todos os Funcion√°rios</button>
        <button onclick="exportarJSON()">üì• Exportar JSON</button>
        <div id="resultado-funcionarios"></div>

        <hr style="margin: 30px 0; border-color: #00ff00;">

        <div class="log success">
            <strong>PASSO 2: TESTAR LOGIN MANUALMENTE</strong>
        </div>
        <div>
            <div style="margin: 10px 0;">
                <label>Login/Email:</label><br>
                <input type="text" id="test-login" value="0" placeholder="Digite o login">
            </div>
            <div style="margin: 10px 0;">
                <label>Senha:</label><br>
                <input type="text" id="test-password" value="0" placeholder="Digite a senha">
            </div>
            <button onclick="testarLogin()">üîç Testar Login</button>
        </div>
        <div id="resultado-teste"></div>

        <hr style="margin: 30px 0; border-color: #00ff00;">

        <div class="log warning">
            <strong>PASSO 3: CORRIGIR FUNCION√ÅRIO</strong>
        </div>
        <div style="margin: 10px 0;">
            <label>Nome do Funcion√°rio:</label><br>
            <input type="text" id="nome-func" placeholder="Digite o nome">
        </div>
        <div style="margin: 10px 0;">
            <label>Novo Login:</label><br>
            <input type="text" id="novo-login" placeholder="Ex: joao.silva">
        </div>
        <div style="margin: 10px 0;">
            <label>Nova Senha:</label><br>
            <input type="text" id="nova-senha" placeholder="Ex: senha123">
        </div>
        <button onclick="corrigirFuncionario()">üîß Atualizar Login/Senha</button>
        <div id="resultado-correcao"></div>

        <hr style="margin: 30px 0; border-color: #00ff00;">

        <div class="log error">
            <strong>‚ö†Ô∏è A√á√ïES PERIGOSAS</strong>
        </div>
        <button onclick="limparTudo()" style="background: #ff0000; color: #fff;">üóëÔ∏è Limpar TUDO</button>
    </div>

    <script>
        function verificarFuncionarios() {
            const div = document.getElementById('resultado-funcionarios')
            const funcionarios = localStorage.getItem('funcionarios-cadastrados')
            
            if (!funcionarios) {
                div.innerHTML = '<div class="log error">‚ùå NENHUM FUNCION√ÅRIO CADASTRADO!</div>'
                return
            }

            const lista = JSON.parse(funcionarios)
            
            let html = '<div class="log success">'
            html += `<strong>üìä TOTAL: ${lista.length} funcion√°rio(s)</strong>\n\n`
            
            lista.forEach((f, i) => {
                html += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`
                html += `${i + 1}. ${f.nome || 'SEM NOME'}\n`
                html += `   C√≥digo: ${f.codigo || 'N/A'}\n`
                html += `   Login: "${f.login}" (tipo: ${typeof f.login})\n`
                html += `   Email: "${f.email || 'N/A'}"\n`
                html += `   Senha: "${f.senha}" (tipo: ${typeof f.senha})\n`
                html += `   CPF: ${f.cpf || 'N/A'}\n`
                
                const temLogin = f.login !== undefined && f.login !== null && String(f.login).trim() !== ''
                const temSenha = f.senha !== undefined && f.senha !== null && String(f.senha).trim() !== ''
                
                html += `\n   ‚úì Tem Login? ${temLogin ? '‚úÖ SIM' : '‚ùå N√ÉO'}\n`
                html += `   ‚úì Tem Senha? ${temSenha ? '‚úÖ SIM' : '‚ùå N√ÉO'}\n`
                html += `   ‚úì Pode Logar? ${temLogin && temSenha ? '‚úÖ‚úÖ SIM!' : '‚ùå‚ùå N√ÉO!'}\n`
                html += `\n`
            })
            
            html += '</div>'
            div.innerHTML = html
        }

        function testarLogin() {
            const div = document.getElementById('resultado-teste')
            const loginDigitado = document.getElementById('test-login').value
            const senhaDigitada = document.getElementById('test-password').value
            
            const funcionarios = localStorage.getItem('funcionarios-cadastrados')
            if (!funcionarios) {
                div.innerHTML = '<div class="log error">‚ùå Nenhum funcion√°rio cadastrado!</div>'
                return
            }

            const lista = JSON.parse(funcionarios)
            
            let html = '<div class="log">'
            html += `<strong>üîç TESTANDO LOGIN</strong>\n\n`
            html += `Login digitado: "${loginDigitado}" (tipo: ${typeof loginDigitado})\n`
            html += `Senha digitada: "${senhaDigitada}" (tipo: ${typeof senhaDigitada})\n\n`
            html += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`
            
            // Buscar funcion√°rio
            const encontrado = lista.find(f => {
                const loginMatch = String(f.login).toLowerCase() === String(loginDigitado).toLowerCase()
                const emailMatch = f.email && String(f.email).toLowerCase() === String(loginDigitado).toLowerCase()
                return loginMatch || emailMatch
            })
            
            if (!encontrado) {
                html += `‚ùå FUNCION√ÅRIO N√ÉO ENCONTRADO!\n\n`
                html += `Logins dispon√≠veis:\n`
                lista.forEach(f => {
                    html += `  - "${f.login}"\n`
                    html += `  - "${f.email}"\n`
                })
                html += `</div>`
                div.innerHTML = html
                return
            }
            
            html += `‚úÖ FUNCION√ÅRIO ENCONTRADO: ${encontrado.nome}\n\n`
            html += `Dados cadastrados:\n`
            html += `  Login: "${encontrado.login}" (tipo: ${typeof encontrado.login})\n`
            html += `  Senha: "${encontrado.senha}" (tipo: ${typeof encontrado.senha})\n\n`
            html += `Compara√ß√£o de Senha:\n`
            html += `  Cadastrada: "${encontrado.senha}"\n`
            html += `  Digitada:   "${senhaDigitada}"\n`
            html += `  String(cadastrada): "${String(encontrado.senha)}"\n`
            html += `  String(digitada):   "${String(senhaDigitada)}"\n`
            html += `  S√£o iguais? ${String(encontrado.senha) === String(senhaDigitada) ? '‚úÖ SIM!' : '‚ùå N√ÉO!'}\n\n`
            
            if (String(encontrado.senha) === String(senhaDigitada)) {
                html += `\n‚úÖ‚úÖ‚úÖ LOGIN V√ÅLIDO! ‚úÖ‚úÖ‚úÖ\n`
                html += `\nVoc√™ PODE fazer login com:\n`
                html += `  Login: ${encontrado.login}\n`
                html += `  Senha: ${encontrado.senha}\n`
                div.innerHTML = html + '</div>'
            } else {
                html += `\n‚ùå SENHA INCORRETA! ‚ùå\n`
                html += `\nSenha cadastrada: "${encontrado.senha}"\n`
                html += `Voc√™ digitou: "${senhaDigitada}"\n`
                div.innerHTML = html + '</div>'
            }
        }

        function corrigirFuncionario() {
            const div = document.getElementById('resultado-correcao')
            const nome = document.getElementById('nome-func').value
            const novoLogin = document.getElementById('novo-login').value
            const novaSenha = document.getElementById('nova-senha').value
            
            if (!nome || !novoLogin || !novaSenha) {
                div.innerHTML = '<div class="log error">‚ùå Preencha todos os campos!</div>'
                return
            }

            const funcionarios = localStorage.getItem('funcionarios-cadastrados')
            if (!funcionarios) {
                div.innerHTML = '<div class="log error">‚ùå Nenhum funcion√°rio cadastrado!</div>'
                return
            }

            let lista = JSON.parse(funcionarios)
            const index = lista.findIndex(f => f.nome.toLowerCase().includes(nome.toLowerCase()))
            
            if (index === -1) {
                div.innerHTML = `<div class="log error">‚ùå Funcion√°rio "${nome}" n√£o encontrado!\n\nFuncion√°rios dispon√≠veis:\n${lista.map(f => `- ${f.nome}`).join('\n')}</div>`
                return
            }

            // Atualizar
            lista[index].login = novoLogin
            lista[index].senha = novaSenha
            
            localStorage.setItem('funcionarios-cadastrados', JSON.stringify(lista))
            
            div.innerHTML = `<div class="log success">‚úÖ FUNCION√ÅRIO ATUALIZADO!\n\nNome: ${lista[index].nome}\nNovo Login: ${novoLogin}\nNova Senha: ${novaSenha}\n\nüéâ Agora tente fazer login!</div>`
        }

        function exportarJSON() {
            const funcionarios = localStorage.getItem('funcionarios-cadastrados')
            if (!funcionarios) {
                alert('‚ùå Nenhum dado para exportar!')
                return
            }

            const blob = new Blob([funcionarios], { type: 'application/json' })
            const link = document.createElement('a')
            link.href = URL.createObjectURL(blob)
            link.download = 'funcionarios-debug.json'
            link.click()
            
            alert('‚úÖ JSON exportado! Verifique na pasta de Downloads')
        }

        function limparTudo() {
            if (!confirm('‚ö†Ô∏è CUIDADO! Isso vai APAGAR TUDO!\n\nTem certeza?')) return
            
            localStorage.removeItem('funcionarios-cadastrados')
            alert('‚úÖ Dados limpos!')
            location.reload()
        }

        // Auto-verificar ao carregar
        window.onload = function() {
            verificarFuncionarios()
        }
    </script>
</body>
</html>

